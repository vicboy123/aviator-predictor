<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aviator Predictor ‚Äì Level 5</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>üöÅ Aviator Predictor (Level 5)</h1>
    <p id="balance">üí∞ Balance: R10.00</p><input id="inputData" placeholder="Enter last 10 crashes, comma separated" />
<input id="betAmount" type="number" placeholder="Bet Amount (R)" />
<input id="targetMultiplier" type="number" placeholder="Target Multiplier (e.g. 2.00)" />

<button onclick="predictAndBet()">üéØ Predict & Bet</button>
<button onclick="resetAll()">‚ôªÔ∏è Reset</button>

<p id="status">Status will appear here...</p>
<p id="prediction">--</p>
<p id="result">--</p>

<div id="streamStatus">Live: Not connected</div>
<div id="historyList"></div>

  </div>
  <script>
    let balance = 10;
    let historyList = [];window.onload = function() {
  const saved = localStorage.getItem("aviator_data");
  if (saved) {
    const data = JSON.parse(saved);
    balance = data.balance || 10;
    historyList = data.history || [];
    updateBalance();
    updateHistory();
  }
  connectLiveData();
};

function saveData() {
  localStorage.setItem("aviator_data", JSON.stringify({ balance, history: historyList }));
}

function updateBalance() {
  document.getElementById("balance").innerText = `üí∞ Balance: R${balance.toFixed(2)}`;
}

function updateHistory() {
  document.getElementById("historyList").innerHTML = historyList.map(i => `<div class="item">${i}</div>`).join("");
}

function predictAndBet() {
  const input = document.getElementById("inputData").value;
  const crashes = input.split(",").map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
  const bet = parseFloat(document.getElementById("betAmount").value);
  const target = parseFloat(document.getElementById("targetMultiplier").value);

  if (crashes.length < 5 || isNaN(bet) || isNaN(target)) {
    document.getElementById("status").innerText = "‚ö†Ô∏è Enter at least 5 crash values and valid bet/target.";
    return;
  }

  if (bet > balance || bet <= 0) {
    document.getElementById("status").innerText = "‚ùå Invalid or insufficient bet.";
    return;
  }

  document.getElementById("status").innerText = "üîç Analyzing with math model...";
  document.getElementById("prediction").innerText = "--";
  document.getElementById("result").innerText = "--";

  setTimeout(() => {
    const avg = crashes.reduce((a, b) => a + b, 0) / crashes.length;
    const variance = crashes.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / crashes.length;
    const stdDev = Math.sqrt(variance);

    const last = crashes[crashes.length - 1];
    const zScore = (last - avg) / stdDev;

    let predicted;
    if (zScore < -1.5) predicted = (Math.random() * 1.2 + 1.3);
    else if (zScore < 0) predicted = (Math.random() * 1.5 + 1.5);
    else predicted = (Math.random() * 2 + 2.2);
    predicted = +predicted.toFixed(2);

    const actual = +(Math.random() * 4 + 1).toFixed(2);
    const win = actual >= target;
    const confidence = Math.max(40, Math.min(95, 100 - stdDev * 12)).toFixed(1);

    let resultText = win ? `‚úÖ WIN! R${(bet * target).toFixed(2)}` : `‚ùå Lost R${bet}`;
    balance += win ? (bet * target) - bet : -bet;

    document.getElementById("status").innerText = `üéØ Target: ${target}x (Confidence: ${confidence}%)`;
    document.getElementById("prediction").innerText = `üìà Predicted: ${predicted}x`;
    document.getElementById("result").innerText = `üí• Crashed at: ${actual}x ‚Üí ${resultText}`;
    updateBalance();

    const now = new Date().toLocaleTimeString();
    historyList.unshift(`${now} ‚Üí Bet R${bet} @ ${target}x ‚Üí Crash: ${actual}x ‚Üí ${win ? 'WIN' : 'LOSE'}`);
    if (historyList.length > 10) historyList.pop();

    updateHistory();
    saveData();
  }, 1500);
}

function resetAll() {
  if (confirm("Reset all data?")) {
    balance = 10;
    historyList = [];
    updateBalance();
    updateHistory();
    localStorage.removeItem("aviator_data");
    document.getElementById("status").innerText = "üîÑ Reset complete.";
    document.getElementById("prediction").innerText = "--";
    document.getElementById("result").innerText = "--";
  }
}

function connectLiveData() {
  try {
    const source = new EventSource("/api/stream");
    source.onmessage = function(event) {
      const data = JSON.parse(event.data);
      if (data && data.crash) {
        document.getElementById("streamStatus").innerText = `Live: Last crash ${data.crash}x`;
      }
    };
    source.onerror = function() {
      document.getElementById("streamStatus").innerText = "Live: Connection failed.";
    };
  } catch (e) {
    document.getElementById("streamStatus").innerText = "Live: Not available.";
  }
}

  </script>
</body>
  </html>
